<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        烂笔头
    </title>
    <meta name="description" content="">
    <link href="atom.xml" rel="alternate" title="烂笔头" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>
        hljs.initHighlightingOnLoad();
    </script>

</head>

<body class="antialiased hide-extras"></body>

<div class="inner-wrap">


    <nav class="top-bar docs-bar hide-for-small" data-topbar>

        <div id="header">
            <h1><a href="index.html">烂笔头</a></h1>
        </div>

    </nav>


    <div class="row">
        <div class="sidebar">
            <ul id="side-nav" class="side-nav">

                
                <li class="side-title"><span>Android</span></li>
                
                <li><a title="Android登录页面，未勾选用户协议、隐私政策出现抖动效果" href="16280609822586.html">Android登录页面，未勾选用户协议、隐私政策出现抖动效果</a></li>
                
                <li><a title="DialogFragment内存泄露问题能不能一次性改好" href="16251021954820.html">DialogFragment内存泄露问题能不能一次性改好</a></li>
                
                <li><a title="Android静默安装实现方案，仿360手机助手秒装和智能安装功能" href="16251021954779.html">Android静默安装实现方案，仿360手机助手秒装和智能安装功能</a></li>
                
                <li><a title="Android 添加水印功能" href="16251021954737.html">Android 添加水印功能</a></li>
                
                <li><a title="Android 监听手电筒状态" href="16251021954689.html">Android 监听手电筒状态</a></li>
                 
                <li class="side-title"><span>Github</span></li>
                
                <li><a title="使用Github+jsdelivr构建你的免费图床" href="16251022060206.html">使用Github+jsdelivr构建你的免费图床</a></li>
                 
                <li class="side-title"><span>Glide</span></li>
                
                <li><a title="Glide源码修改-自定义磁盘缓存实现永久存储" href="16251022251608.html">Glide源码修改-自定义磁盘缓存实现永久存储</a></li>
                
                <li><a title="Android—Glide使用教程（一）" href="16251022251568.html">Android—Glide使用教程（一）</a></li>
                
                <li><a title="Android—Glide使用教程（二）" href="16251022251484.html">Android—Glide使用教程（二）</a></li>
                
                <li><a title="Android—Glide使用教程（三）" href="16251022251527.html">Android—Glide使用教程（三）</a></li>
                 
                <li class="side-title"><span>Gradle</span></li>
                
                <li><a title="Gradle 自定义Plugin插件之上传APK到蒲公英" href="16280610391708.html">Gradle 自定义Plugin插件之上传APK到蒲公英</a></li>
                
                <li><a title="自定义Gradle Plugin，优雅的解决第三方Jar包中的bug" href="16280610391664.html">自定义Gradle Plugin，优雅的解决第三方Jar包中的bug</a></li>
                
                <li><a title="如何使用Android Studio开发Gradle插件" href="16280610391616.html">如何使用Android Studio开发Gradle插件</a></li>
                
                <li><a title="sourceSets使用" href="16251022385733.html">sourceSets使用</a></li>
                
                <li><a title="脑洞大开，Gradle项目管理依赖的船新版本" href="16251022385689.html">脑洞大开，Gradle项目管理依赖的船新版本</a></li>
                 
                <li class="side-title"><span>Rxjava</span></li>
                
                <li><a title="RxJava2 只看这一篇文章就够了" href="16251022491138.html">RxJava2 只看这一篇文章就够了</a></li>
                 
                <li class="side-title"><span>GreenDAO</span></li>
                
                <li><a title="GreenDao 3.3.0 基本使用与入门 （一）" href="16280610693006.html">GreenDao 3.3.0 基本使用与入门 （一）</a></li>
                
                <li><a title="GreenDao 3.3.0 多表关联使用（二）" href="16280610765764.html">GreenDao 3.3.0 多表关联使用（二）</a></li>
                
                <li><a title="GreenDao 3.3.0 增删改查的使用（三）" href="16280610843145.html">GreenDao 3.3.0 增删改查的使用（三）</a></li>
                 
                <li class="side-title"><span>组件化</span></li>
                
                <li><a title="组件化架构之解决Common组件中心化问题(api化方案)" href="16280609309201.html">组件化架构之解决Common组件中心化问题(api化方案)</a></li>
                 
            </ul>
        </div>
        <div class="columns"> <div id="main-content" class="markdown-body">
    <h1>Android—Glide使用教程（二）</h1>

    <ul>
<li>
<a href="#toc_0"><strong>1. Glide缓存</strong> 分为两种，</a>
<ul>
<li>
<a href="#toc_1"><strong>内存缓存</strong></a>
</li>
<li>
<a href="#toc_2"><strong>磁盘缓存</strong></a>
</li>
<li>
<a href="#toc_3"><strong>两种缓存都不使用</strong></a>
</li>
</ul>
</li>
<li>
<a href="#toc_4"><strong>2.图片请求的优先级</strong></a>
</li>
<li>
<a href="#toc_5"><strong>3.自定义缩略图</strong></a>
<ul>
<li>
<a href="#toc_6"><strong>thumbnail(0.1f)</strong></a>
</li>
<li>
<a href="#toc_7"><strong>下面这种自定义缩略图</strong></a>
</li>
</ul>
</li>
<li>
<a href="#toc_8"><strong>4.Glide 中的回调：Targets</strong></a>
<ul>
<li>
<a href="#toc_9"><strong>ViewTarget自定义视图</strong></a>
</li>
<li>
<a href="#toc_10"><strong>加载图片到Notifications</strong></a>
</li>
</ul>
</li>
</ul>


<h1 id="toc_0"><strong>1. Glide缓存</strong> 分为两种，</h1>

<ul>
<li>内存缓存
<ul>
<li>skipMemoryCache(true)</li>
</ul></li>
<li>磁盘缓存
<ul>
<li>DiskCacheStrategy.NONE 什么都不缓存，</li>
<li>DiskCacheStrategy.SOURCE 仅仅只缓存原来的全分辨率的图像</li>
<li>DiskCacheStrategy.RESULT 仅仅缓存最终的图像，即，降低分辨率后的（或者是转换后的）</li>
<li>DiskCacheStrategy.ALL 缓存所有版本的图像（默认行为）</li>
</ul></li>
</ul>

<hr/>

<h2 id="toc_1"><strong>内存缓存</strong></h2>

<p>Glide默认将图片资源缓存到<strong>内存</strong>，当我们不想使用<strong>内存缓存</strong>时。跳过内存缓存<strong>skipMemoryCache(true)</strong>见名知意。同时，Glide将会仍然使用<strong>磁盘缓存，</strong>来避免重复请求网络数据。</p>

<pre><code class="language-text">Glide.with(this)
                .load(&quot;http://2f.zol-img.com.cn/product/104_1200x900/305/cevDJaCdeLQ6.gif&quot;)
                .override(800, 300)
                .skipMemoryCache(true) //跳过内存缓存
                .placeholder(R.mipmap.ic_launcher)
                .error(R.mipmap.ic_launcher_round)
                .into(iv_2);
</code></pre>

<h2 id="toc_2"><strong>磁盘缓存</strong></h2>

<p>就不多说，直接上代码。 我们需要根据上述所给的几种类型，来选择你需要的方式。</p>

<pre><code class="language-text">Glide.with(this)
                .load(&quot;http://2f.zol-img.com.cn/product/104_1200x900/305/cevDJaCdeLQ6.gif&quot;)
                .override(800, 300)
                .diskCacheStrategy(DiskCacheStrategy.NONE)
                .placeholder(R.mipmap.ic_launcher)
                .error(R.mipmap.ic_launcher_round)
                .into(iv_2);
</code></pre>

<h2 id="toc_3"><strong>两种缓存都不使用</strong></h2>

<p>同时调用两个方法</p>

<pre><code class="language-text">Glide.with(this)
                .load(&quot;http://2f.zol-img.com.cn/product/104_1200x900/305/cevDJaCdeLQ6.gif&quot;)
                .override(800, 300)
                .skipMemoryCache(true) //跳过内存缓存
                .diskCacheStrategy(DiskCacheStrategy.NONE)
                .placeholder(R.mipmap.ic_launcher)
                .error(R.mipmap.ic_launcher_round)
                .into(iv_2);
</code></pre>

<hr/>

<h1 id="toc_4"><strong>2.图片请求的优先级</strong></h1>

<p>在开发过程中，比如A图片是一张非常大的图片，B,C图片相对要小。这个时候我们需要让A图片先加载显示。我们就需要使用该方法。 这个枚举给了四个不同的选项，下面是按照<strong>递增priority(优先级)</strong>的列表：</p>

<ul>
<li><p>Priority.LOW</p></li>
<li><p>Priority.NORMAL</p></li>
<li><p>Priority.HIGH</p></li>
<li><p>Priority.IMMEDIATE</p>
<p>具体代码</p></li>
</ul>

<p>这个时候会先加载 带有<strong>Priority.HIGH</strong>属性的图片资源，然后才去加载<strong>Priority.LOW</strong>属性的图片资源。 还有一个情况，是我在测试的时候遇到： 发现，如果<strong>优先级较低</strong>的图片<strong>有设置缓存数据</strong>，当我们第二次再次进入这个界面时，该图片会<strong>优先于未设置缓存数据</strong>的图片，先加载出来。可以自行测试</p>

<pre><code class="language-text">Glide.with(this)
                .load(&quot;http://pic6.huitu.com/res/20130116/84481_20130116142820494200_1.jpg&quot;)
                .placeholder(R.drawable.ic_launcher)
                .error(R.mipmap.ic_launcher_round)
                .priority(Priority.LOW)
                .into(iv_1);
        tv_title2.setText(&quot;加载gif资源&quot;);
      
        Glide.with(this)
                .load(&quot;http://2f.zol-img.com.cn/product/104_1200x900/305/cevDJaCdeLQ6.gif&quot;)
                .override(800, 300)
                .priority(Priority.HIGH)
                .placeholder(R.mipmap.ic_launcher)
                .error(R.mipmap.ic_launcher_round)
                .into(iv_2);
</code></pre>

<hr/>

<h1 id="toc_5"><strong>3.自定义缩略图</strong></h1>

<p>概述：<strong>缩略图不同</strong>于之前博客提到的占位符。<strong>占位符必须</strong>附带应用程序<strong>捆绑的资源</strong>才行。缩略图是<strong>动态占位符</strong>。它也可以从网络中加载。缩略图将会在实际请求加载完或者处理完之后才显示。如果缩略图对于任何原因，在原始图像到达之后，它不会取代原始图像。它只会被抹除。</p>

<pre><code class="language-text">Glide.with(this)
                .load(&quot;http://pic6.huitu.com/res/20130116/84481_20130116142820494200_1.jpg&quot;)
                .thumbnail(0.1f)
                .into(iv_8);
</code></pre>

<h2 id="toc_6"><strong>thumbnail(0.1f)</strong></h2>

<p>这个属性，实现的效果是原图1000<em>1000,缩小十倍100</em>100缩略图显示出来。</p>

<h2 id="toc_7"><strong>下面这种自定义缩略图</strong></h2>

<p>它的优点多说了，看上面的概述。</p>

<pre><code class="language-text">DrawableRequestBuilder&lt;Integer&gt; thumbail = Glide.with(this)
                .load(R.drawable.ic_pb_default);
        Glide.with(this)
                .load(&quot;http://pic6.huitu.com/res/20130116/84481_20130116142820494200_1.jpg&quot;)
                .thumbnail(thumbail)
                .into(iv_8);
</code></pre>

<p>所不同的是，第一个缩略图请求是完全独立于第二个原始请求的。该缩略图<strong>可以是不同的资源或图片 URL</strong>，你可以为其应用不同的转换，等等。</p>

<hr/>

<h1 id="toc_8"><strong>4.Glide 中的回调：Targets</strong></h1>

<p>概述：前面所讲的在<strong>into()*<em>里设置ImageVeiw，试想一下，如果这将不是最后一步，可以在*</em>into()*<em>里设置*</em>Targets</strong>的方式去接受图片资源的Bitmap。Targets 是没有任何别的回调，它在 Glide 做完所有的加载和处理之后返回结果。</p>

<pre><code class="language-text">private SimpleTarget simpleTarget = new SimpleTarget&lt;Bitmap&gt;(200,200) {
            @Override
            public void onResourceReady(Bitmap resource, GlideAnimation&lt;? super Bitmap&gt; glideAnimation) {
                iv_9.setImageBitmap(resource);
            }
        };
        tv_title9.setText(&quot;Glide 中的回调：Targets&quot;);
        Glide.with(this)
                .load(&quot;http://pic6.huitu.com/res/20130116/84481_20130116142820494200_1.jpg&quot;)
                .asBitmap()
                .into(simpleTarget);
复制代码
</code></pre>

<ul>
<li>从代码中我们可以看到，使用了<strong>asBitmap()*<em>方法，主要是因为后台返回的资源地址，有GIF等多种类型，而*</em>SimpleTarget</strong>参数类型是Bitmap类型。所以要把Glide加载的图片资源强制转换成<strong>asBitmap()</strong>资源。</li>
<li>根据JAVA/android语法规定，允许<strong>init()*<em>方法里去使用*</em>匿名内部类</strong>。Glide在请求加载图片之前，在<strong>手机内存较低</strong>的情况下，会导致Android垃圾回收机制<strong>移除了匿名内部类</strong>。当图片加载成时，就<strong>不会再去回调</strong>该方法。所以我们要保证把simpleTarget声明成一个<strong>字段对象</strong>，这样就可以防止被Android垃圾回收机制移除。</li>
<li>第二个关键部分是 Glide 建造者中这行：with(context)。 这里的问题实际是 Glide 的功能：当你传了一个 context，例如是当前应用的 activity，Glide <strong>将会自动停止请求当请求的 activity 已经停止</strong>的时候。这整合到了应用的生命周期中通常是非常有帮助的，但是有时工作起来是困难的，如果你的 target 是<strong>独立于应用</strong>的 activity 生命周期。这里的解决方案是用 application 的 context: .with(context.getApplicationContext))。当<strong>应用资深完全停止</strong>时，Glide 才会杀死这个图片请求。请求记住，再说一次，如果你的请求需要在 activity 生命周期之外去做时，才用下面这样的代码：</li>
</ul>

<pre><code class="language-text">Glide.with(getApplicationContext))
                .load(&quot;http://pic6.huitu.com/res/20130116/84481_20130116142820494200_1.jpg&quot;)
                .asBitmap()
                .into(simpleTarget);
复制代码
</code></pre>

<p>当然可能有人再问，如果我想设置ImageView大小。这我Glide已经有解决方法，<strong>Target是可以指定尺寸</strong>。使用方法，看上面的代码。具体看源码。</p>

<p><img src="https://cdn.jsdelivr.net/gh/api888/PublicPic@main//img/d8689414e9544d74a99631ea49fb00ad_tplv-k3u1fbpfcp-zoom-1.jpg" alt=""/></p>

<h2 id="toc_9"><strong>ViewTarget自定义视图</strong></h2>

<p>这个主要是用在自定义View,比如我们程序中有一个组合自定义控件，里面有ImageView需要我们设置。这个时候用ViewTarget更容易实现。</p>

<pre><code class="language-text">FutureStudioView studioView = (FutureStudioView) findViewById(R.id.custom_view);
        ViewTarget viewTarget = new ViewTarget&lt;FutureStudioView, GlideDrawable&gt;(studioView) {

            @Override
            public void onResourceReady(GlideDrawable resource, GlideAnimation&lt;? super GlideDrawable&gt; glideAnimation) {
                this.view.setImage(resource.getCurrent());
               this.view.setText(String.valueOf(resource.getCurrent()));
            }
        };
        Glide.with(this)
                .load(&quot;http://pic6.huitu.com/res/20130116/84481_20130116142820494200_1.jpg&quot;)
                .into(viewTarget);
复制代码
</code></pre>

<p>认真研究，你会发现，我们还可以在ViewTarget里面去给TextView设置值。具体自己去测试吧。</p>

<h2 id="toc_10"><strong>加载图片到Notifications</strong></h2>

<p>见名知意，就是通知栏图标嘛。Glide还提供了方便舒适的方式：<strong>NotificationTarget</strong>。我们用效果图说话吧。 </p>

<p><img src="https://cdn.jsdelivr.net/gh/api888/PublicPic@main//img/d04a63a4d2ef4ad5b818d694a57087e9_tplv-k3u1fbpfcp-zoom-1.jpg" alt=""/></p>

<p>模拟器不是特别美观，讲究这看下。也别太在意这些细节。具体代码会有下载地址。</p>

<p><a href="https://github.com/z244370114/GlideDemo">DEMO地址请自行下载</a></p>


</div>

<br /><br />
<hr />

<div class="content-nav">
    <div class="large-6 columns">
        <div class="text-left" style="padding:15px 0px;">
            
            <a href="16280610693006.html" title="Previous Post: GreenDao 3.3.0 基本使用与入门 （一）">&laquo; GreenDao 3.3.0 基本使用与入门 （一）</a> 
        </div>
    </div>
    <div class="large-6 columns">
        <div class="text-right" style="padding:15px 0px;">
            
            <a href="16280610765764.html" title="Next Post: GreenDao 3.3.0 多表关联使用（二）">GreenDao 3.3.0 多表关联使用（二） &raquo;</a> 
        </div>
    </div>
</div>

<div class="content_share">
    <div style="padding:0px 0.93em;" class="share-comments">
        
    </div>
</div>
<script type="text/javascript">
    $(function() {
        var currentURL = '16251022251484.html';
        $('#side-nav a').each(function() {
            if ($(this).attr('href') == currentURL) {
                $(this).parent().addClass('active');
            }
        });
    });
</script>  </div>
</div>


<div class="page-bottom">
    <div class="copyright">
        <a href="mailto:888api@sina.com">郝彬彬</a> &copy; 
    </div>
    <div class="copyright text-right">
        <a href="#main-content">TOP</a>
    </div>
</div>

</div>




  














<style type="text/css">
    figure {
        margin: 0.4em 0;
        padding: 0;
    }
    
    figcaption {
        text-align: center;
    }
    /* PrismJS 1.14.0
 http://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript */
    /**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */
    
    code[class*="language-"],
    pre[class*="language-"] {
        color: black;
        background: none;
        text-shadow: 0 1px white;
        font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
        text-align: left;
        white-space: pre;
        word-spacing: normal;
        word-break: normal;
        word-wrap: normal;
        line-height: 1.5;
        -moz-tab-size: 4;
        -o-tab-size: 4;
        tab-size: 4;
        -webkit-hyphens: none;
        -moz-hyphens: none;
        -ms-hyphens: none;
        hyphens: none;
    }
    
    pre[class*="language-"]::-moz-selection,
    pre[class*="language-"] ::-moz-selection,
    code[class*="language-"]::-moz-selection,
    code[class*="language-"] ::-moz-selection {
        text-shadow: none;
        background: #b3d4fc;
    }
    
    pre[class*="language-"]::selection,
    pre[class*="language-"] ::selection,
    code[class*="language-"]::selection,
    code[class*="language-"] ::selection {
        text-shadow: none;
        background: #b3d4fc;
    }
    
    @media print {
        code[class*="language-"],
        pre[class*="language-"] {
            text-shadow: none;
        }
    }
    /* Code blocks */
    
    pre[class*="language-"] {
        padding: 1em;
        margin: .5em 0;
        overflow: auto;
    }
    
     :not(pre)>code[class*="language-"],
    pre[class*="language-"] {
        background: #F7F7F7;
    }
    /* Inline code */
    
     :not(pre)>code[class*="language-"] {
        padding: .1em;
        border-radius: .3em;
        white-space: normal;
    }
    
    .token.comment,
    .token.prolog,
    .token.doctype,
    .token.cdata {
        color: slategray;
    }
    
    .token.punctuation {
        color: #999;
    }
    
    .namespace {
        opacity: .7;
    }
    
    .token.property,
    .token.tag,
    .token.boolean,
    .token.number,
    .token.constant,
    .token.symbol,
    .token.deleted {
        color: #905;
    }
    
    .token.selector,
    .token.attr-name,
    .token.string,
    .token.char,
    .token.builtin,
    .token.inserted {
        color: #690;
    }
    
    .token.operator,
    .token.entity,
    .token.url,
    .language-css .token.string,
    .style .token.string {
        color: #9a6e3a;
        background: hsla(0, 0%, 100%, .5);
    }
    
    .token.atrule,
    .token.attr-value,
    .token.keyword {
        color: #07a;
    }
    
    .token.function,
    .token.class-name {
        color: #DD4A68;
    }
    
    .token.regex,
    .token.important,
    .token.variable {
        color: #e90;
    }
    
    .token.important,
    .token.bold {
        font-weight: bold;
    }
    
    .token.italic {
        font-style: italic;
    }
    
    .token.entity {
        cursor: help;
    }
    
    pre[class*="language-"].line-numbers {
        position: relative;
        padding-left: 3.8em;
        counter-reset: linenumber;
    }
    
    pre[class*="language-"].line-numbers>code {
        position: relative;
        white-space: inherit;
    }
    
    .line-numbers .line-numbers-rows {
        position: absolute;
        pointer-events: none;
        top: 0;
        font-size: 100%;
        left: -3.8em;
        width: 3em;
        /* works for line-numbers below 1000 lines */
        letter-spacing: -1px;
        border-right: 1px solid #999;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    
    .line-numbers-rows>span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }
    
    .line-numbers-rows>span:before {
        content: counter(linenumber);
        color: #999;
        display: block;
        padding-right: 0.8em;
        text-align: right;
    }
</style>

<script src="asset/js/foundation.min.js"></script>
<script src="asset/js/foundation/foundation.offcanvas.js"></script>
<script>
    $(document).foundation();
</script>
<script src="asset/js/watermark.js"></script>

</body>

</html>